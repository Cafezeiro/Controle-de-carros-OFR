<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Painel de Carregamento</title>

<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-database-compat.js"></script>

<style>
body{background:#071028;color:#fff;font-family:Arial;margin:0;padding:20px}
h1{text-align:center;color:#38bdf8}
table{width:100%;border-collapse:collapse;margin-top:20px;font-size:18px}
th,td{padding:12px;border-bottom:1px solid #334155;text-align:center}
.ofr{background:#7f1d1d;font-weight:bold}
</style>
</head>

<body>
<h1>üöõ PAINEL DE CARREGAMENTO</h1>

<table>
<thead>
<tr>
<th>#</th>
<th>Transporte</th>
<th>Placa</th>
<th>Chegada</th>
<th>Tempo √Årea</th>
<th>Tipo</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

<script>
// üî• FIREBASE CONFIG (IGUAL AO CADASTRO)
const firebaseConfig = {
  apiKey: "AIzaSyC4QzvRKk-l7F9RbgIt_N7_It3FxZ_TIhM",
  authDomain: "controle-carregamento.firebaseapp.com",
  databaseURL: "https://controle-carregamento-default-rtdb.firebaseio.com",
  projectId: "controle-carregamento",
  storageBucket: "controle-carregamento.firebasestorage.app",
  messagingSenderId: "880348216752",
  appId: "1:880348216752:web:fbea1e525c37c877e22a75"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const tbody = document.getElementById("tbody");

let fila = {};

function tempo(iso){
  const diff = Date.now() - new Date(iso).getTime();
  const m = Math.floor(diff/60000);
  return m < 0 ? "-" : m + " min";
}

function render(){
  const lista = Object.values(fila)
    .sort((a,b)=>a.tipo==="OFR"?-1:1);

  tbody.innerHTML = "";
  lista.forEach((v,i)=>{
    tbody.innerHTML += `
      <tr class="${v.tipo==="OFR"?"ofr":""}">
        <td>${i+1}</td>
        <td>${v.transporte}</td>
        <td>${v.placa}</td>
        <td>${new Date(v.chegada).toLocaleTimeString()}</td>
        <td>${tempo(v.chegada)}</td>
        <td>${v.tipo}</td>
      </tr>`;
  });
}

// üîÑ TEMPO REAL
db.ref("fila").on("value", snap=>{
  fila = snap.val() || {};
  render();
});

// ‚è±Ô∏è Atualiza tempo sozinho
setInterval(render, 60000);
</script>
</body>
</html>
